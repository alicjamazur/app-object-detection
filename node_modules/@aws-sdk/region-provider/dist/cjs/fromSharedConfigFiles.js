"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.fromSharedConfigFiles = exports.ENV_PROFILE = void 0;
var tslib_1 = require("tslib");
var property_provider_1 = require("@aws-sdk/property-provider");
var shared_ini_file_loader_1 = require("@aws-sdk/shared-ini-file-loader");
var DEFAULT_PROFILE = "default";
exports.ENV_PROFILE = "AWS_PROFILE";
exports.fromSharedConfigFiles = function (init) {
    if (init === void 0) { init = {}; }
    return function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
        var _a, loadedConfig, _b, profile, _c, configFile, credentialsFile, _d, _e, file, region;
        var e_1, _f;
        return tslib_1.__generator(this, function (_g) {
            switch (_g.label) {
                case 0:
                    _a = init.loadedConfig, loadedConfig = _a === void 0 ? shared_ini_file_loader_1.loadSharedConfigFiles(init) : _a, _b = init.profile, profile = _b === void 0 ? process.env[exports.ENV_PROFILE] || DEFAULT_PROFILE : _b;
                    return [4 /*yield*/, loadedConfig];
                case 1:
                    _c = _g.sent(), configFile = _c.configFile, credentialsFile = _c.credentialsFile;
                    try {
                        for (_d = tslib_1.__values([credentialsFile, configFile]), _e = _d.next(); !_e.done; _e = _d.next()) {
                            file = _e.value;
                            region = (file[profile] || {}).region;
                            if (typeof region === "string") {
                                return [2 /*return*/, region];
                            }
                        }
                    }
                    catch (e_1_1) { e_1 = { error: e_1_1 }; }
                    finally {
                        try {
                            if (_e && !_e.done && (_f = _d.return)) _f.call(_d);
                        }
                        finally { if (e_1) throw e_1.error; }
                    }
                    throw new property_provider_1.ProviderError("No region found for profile " + profile + " in SDK configuration files");
            }
        });
    }); };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnJvbVNoYXJlZENvbmZpZ0ZpbGVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2Zyb21TaGFyZWRDb25maWdGaWxlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsZ0VBQTJEO0FBQzNELDBFQUl5QztBQUd6QyxJQUFNLGVBQWUsR0FBRyxTQUFTLENBQUM7QUFDckIsUUFBQSxXQUFXLEdBQUcsYUFBYSxDQUFDO0FBZTVCLFFBQUEscUJBQXFCLEdBQUcsVUFBQyxJQUEyQjtJQUEzQixxQkFBQSxFQUFBLFNBQTJCO0lBQXVCLE9BQUE7Ozs7OztvQkFDOUUsS0FBc0csSUFBSSxhQUFoRSxFQUExQyxZQUFZLG1CQUFHLDhDQUFxQixDQUFDLElBQUksQ0FBQyxLQUFBLEVBQUUsS0FBMEQsSUFBSSxRQUFULEVBQXJELE9BQU8sbUJBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBVyxDQUFDLElBQUksZUFBZSxLQUFBLENBQVU7b0JBRTNFLHFCQUFNLFlBQVksRUFBQTs7b0JBQXBELEtBQWtDLFNBQWtCLEVBQWxELFVBQVUsZ0JBQUEsRUFBRSxlQUFlLHFCQUFBOzt3QkFDbkMsS0FBbUIsS0FBQSxpQkFBQSxDQUFDLGVBQWUsRUFBRSxVQUFVLENBQUMsQ0FBQSw0Q0FBRTs0QkFBdkMsSUFBSTs0QkFDTCxNQUFNLEdBQUssQ0FBQSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQVMsRUFBRSxDQUFBLE9BQTdCLENBQThCOzRCQUM1QyxJQUFJLE9BQU8sTUFBTSxLQUFLLFFBQVEsRUFBRTtnQ0FDOUIsc0JBQU8sTUFBTSxFQUFDOzZCQUNmO3lCQUNGOzs7Ozs7Ozs7b0JBRUQsTUFBTSxJQUFJLGlDQUFhLENBQUMsaUNBQStCLE9BQU8sZ0NBQTZCLENBQUMsQ0FBQzs7O1NBQzlGO0FBWnVGLENBWXZGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcm92aWRlckVycm9yIH0gZnJvbSBcIkBhd3Mtc2RrL3Byb3BlcnR5LXByb3ZpZGVyXCI7XG5pbXBvcnQge1xuICBsb2FkU2hhcmVkQ29uZmlnRmlsZXMsXG4gIFNoYXJlZENvbmZpZ0ZpbGVzLFxuICBTaGFyZWRDb25maWdJbml0IGFzIEJhc2VTaGFyZWRDb25maWdJbml0LFxufSBmcm9tIFwiQGF3cy1zZGsvc2hhcmVkLWluaS1maWxlLWxvYWRlclwiO1xuaW1wb3J0IHsgUHJvdmlkZXIgfSBmcm9tIFwiQGF3cy1zZGsvdHlwZXNcIjtcblxuY29uc3QgREVGQVVMVF9QUk9GSUxFID0gXCJkZWZhdWx0XCI7XG5leHBvcnQgY29uc3QgRU5WX1BST0ZJTEUgPSBcIkFXU19QUk9GSUxFXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2hhcmVkQ29uZmlnSW5pdCBleHRlbmRzIEJhc2VTaGFyZWRDb25maWdJbml0IHtcbiAgLyoqXG4gICAqIFRoZSBjb25maWd1cmF0aW9uIHByb2ZpbGUgdG8gdXNlLlxuICAgKi9cbiAgcHJvZmlsZT86IHN0cmluZztcblxuICAvKipcbiAgICogQSBwcm9taXNlIHRoYXQgd2lsbCBiZSByZXNvbHZlZCB3aXRoIGxvYWRlZCBhbmQgcGFyc2VkIGNyZWRlbnRpYWxzIGZpbGVzLlxuICAgKiBVc2VkIHRvIGF2b2lkIGxvYWRpbmcgc2hhcmVkIGNvbmZpZyBmaWxlcyBtdWx0aXBsZSB0aW1lcy5cbiAgICovXG4gIGxvYWRlZENvbmZpZz86IFByb21pc2U8U2hhcmVkQ29uZmlnRmlsZXM+O1xufVxuXG5leHBvcnQgY29uc3QgZnJvbVNoYXJlZENvbmZpZ0ZpbGVzID0gKGluaXQ6IFNoYXJlZENvbmZpZ0luaXQgPSB7fSk6IFByb3ZpZGVyPHN0cmluZz4gPT4gYXN5bmMgKCkgPT4ge1xuICBjb25zdCB7IGxvYWRlZENvbmZpZyA9IGxvYWRTaGFyZWRDb25maWdGaWxlcyhpbml0KSwgcHJvZmlsZSA9IHByb2Nlc3MuZW52W0VOVl9QUk9GSUxFXSB8fCBERUZBVUxUX1BST0ZJTEUgfSA9IGluaXQ7XG5cbiAgY29uc3QgeyBjb25maWdGaWxlLCBjcmVkZW50aWFsc0ZpbGUgfSA9IGF3YWl0IGxvYWRlZENvbmZpZztcbiAgZm9yIChjb25zdCBmaWxlIG9mIFtjcmVkZW50aWFsc0ZpbGUsIGNvbmZpZ0ZpbGVdKSB7XG4gICAgY29uc3QgeyByZWdpb24gfSA9IGZpbGVbcHJvZmlsZV0gfHwgPGFueT57fTtcbiAgICBpZiAodHlwZW9mIHJlZ2lvbiA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgcmV0dXJuIHJlZ2lvbjtcbiAgICB9XG4gIH1cblxuICB0aHJvdyBuZXcgUHJvdmlkZXJFcnJvcihgTm8gcmVnaW9uIGZvdW5kIGZvciBwcm9maWxlICR7cHJvZmlsZX0gaW4gU0RLIGNvbmZpZ3VyYXRpb24gZmlsZXNgKTtcbn07XG4iXX0=